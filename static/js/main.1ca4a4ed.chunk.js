(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{139:function(e,t,n){e.exports=n(309)},144:function(e,t,n){},169:function(e,t){},171:function(e,t){},237:function(e,t){},238:function(e,t){},255:function(e,t,n){},256:function(e,t,n){},309:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(14),i=n.n(r),l=(n(144),n(15)),c=n(16),s=n(18),u=n(17),p=n(19),d=n(130),m=n.n(d),h=n(131),g=n(4),f=n(77),v=n.n(f)()("mqtt")("SUBSCRIBE"),b="/hfp/v1/journey/#",y={topic:b},w=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(s.a)(this,Object(u.a)(t).call(this,e))).mqttClient=void 0,n.onConnect=function(){(n.props.topic!==b||n.props.trackAll)&&n.connect(n.props.topic)},n.disConnect=function(e){n.mqttClient.unsubscribe(e,function(){n.props.clearBusMarker()})},n.connect=function(e){n.mqttClient.subscribe(e,function(e){})},n.onError=function(e){},n.onMessage=function(e,t){var a=JSON.parse(t.toString());n.props.onReceive(a.VP)},n.mqttClient=Object(h.connect)("mqtts://mqtt.hsl.fi:443"),n.mqttClient.on("connect",n.onConnect),n.mqttClient.on("message",n.onMessage),n.mqttClient.on("error",n.onError),n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"componentWillReceiveProps",value:function(e){e.topic!==this.props.topic&&(this.disConnect(this.props.topic),this.connect(e.topic))}},{key:"render",value:function(){return o.a.createElement("div",null)}}]),t}(a.PureComponent),E=function(e){function t(){var e,n;Object(l.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(s.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).busMarkers={},n.infoWindow=void 0,n.infoWindowBusKey=void 0,n.map=null,n.maps=null,n.routePath=null,n.switchTopic=!1,n.currentLocation=null,n.handleApiLoaded=function(e,t){n.map=e,n.maps=t,t.event.addListener(e,"click",function(){n.closeOtherInfoWindow()}),n.regCurrentLocation()},n.getCoords=function(e){return{lat:e.lat,lng:e.long}},n.getKey=function(e){return"".concat(e.desi,"-").concat(e.dir,"-").concat(e.veh)},n.isMarkerExist=function(e){var t=n.getKey(e);return void 0!==n.busMarkers[t]},n.handleMQTT=function(e){n.map&&n.maps&&(n.isMarkerExist(e)?n.updateMarker(e):n.createMarker(e))},n.clearBusMarker=function(){if(n.switchTopic){for(var e in n.busMarkers)n.busMarkers[e].setMap(null);n.busMarkers={},n.switchTopic=!1}},n.closeOtherInfoWindow=function(){n.infoWindow&&n.infoWindow.close()},n.createMarker=function(e){var t=n.getCoords(e),a=t.lat,o=t.lng;if(a&&o){var r={path:n.maps.SymbolPath.FORWARD_CLOSED_ARROW,scale:3.5,rotation:e.hdg,strokeColor:"#e91e63",strokeWeight:2.5,fillOpacity:1,fillColor:"#e91e63"},i=new n.maps.Marker({position:{lat:a,lng:o},map:n.map,icon:r}),l=n.getKey(e);n.busMarkers[l]=i,i.addListener("click",function(){n.closeOtherInfoWindow();var t=n.getInfoWindowContent(e);n.infoWindowBusKey=l,n.infoWindow=new n.maps.InfoWindow({content:t}),n.infoWindow.open(n.map,n.busMarkers[l])})}},n.getInfoWindowContent=function(e){var t;return e.dl&&(t=parseInt(e.dl)>0?e.dl<100?"Early: ".concat(e.dl,"s"):"Early: ".concat((e.dl/60).toFixed(2),"mins"):Math.abs(e.dl)<100?"Delayed: ".concat(Math.abs(e.dl),"s"):"Delayed: ".concat((Math.abs(e.dl)/60).toFixed(2),"mins")),'\n\t\t\t\t\t<ul style="\n\t\t\t\t\t\tlist-style-type: none;\n\t\t\t\t\t\tpadding: 0;\n\t\t\t\t\t\tmargin: 0;\n\t\t\t\t\t\tfont-size: 14px;\n\t\t\t\t\t\twidth: 200px;\n\t\t\t\t\t">\n\t\t\t\t\t\t<li>No: '.concat(e.desi,"</li>\n\t\t\t\t\t\t<li>Speed: ").concat(e.spd?(3.6*e.spd).toFixed(2):0," km/h</li>\n\t\t\t\t\t\t").concat(void 0!==t?"<li>".concat(t,"</li>"):"","\n\t\t\t\t\t</ul>\n\t\t\t\t\t")},n.updateMarker=function(e){var t=n.getCoords(e),a=t.lat,o=t.lng,r=n.getKey(e);a&&o&&n.busMarkers[r].setPosition({lat:a,lng:o}),n.infoWindow&&n.infoWindowBusKey===r&&n.infoWindow.setContent(n.getInfoWindowContent(e))},n.regCurrentLocation=function(){null==n.currentLocation&&(n.currentLocation=new n.maps.Marker({position:{lat:n.props.center.lat,lng:n.props.center.lng},map:n.map,icon:{path:n.maps.SymbolPath.CIRCLE,scale:7,strokeColor:"#C8D6EC",strokeWeight:2.5,fillOpacity:1,fillColor:"#4285F4"}})),navigator.geolocation.watchPosition(function(e){var t=e.coords,a=t.latitude,o=t.longitude;n.currentLocation.setPosition({lat:a,lng:o})},function(){},{enableHighAccuracy:!1,timeout:5e3,maximumAge:0})},n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"componentWillReceiveProps",value:function(e){e.topic!==this.props.topic&&(this.switchTopic=!0)}},{key:"componentWillUpdate",value:function(e){if(e.topic!==B){if(e.geos&&this.maps&&this.map){this.routePath&&this.routePath.setMap(null);var t=new this.maps.LatLngBounds;this.routePath=new this.maps.Polyline({path:e.geos.geometry.map(function(e){var n={lat:e.lat,lng:e.lon};return t.extend(n),n}),geodesic:!0,strokeColor:"#2196F3",strokeOpacity:1,strokeWeight:3}),this.routePath.setMap(this.map),t.getCenter(),this.map.fitBounds(t)}}else this.routePath.setMap(null)}},{key:"render",value:function(){var e=this;return o.a.createElement("div",{style:{height:"100vh",width:"100%"}},o.a.createElement(m.a,{bootstrapURLKeys:{key:"AIzaSyBXy6VGyQlLMU9cFIgPh3AzCva_zXY2YJY"},center:this.props.center,defaultZoom:15,options:{gestureHandling:"greedy",zoomControl:!1},yesIWantToUseGoogleMapApiInternals:!0,onGoogleApiLoaded:function(t){var n=t.map,a=t.maps;return e.handleApiLoaded(n,a)}}),o.a.createElement(w,{trackAll:!0,onReceive:this.handleMQTT,clearBusMarker:this.clearBusMarker,topic:this.props.topic}))}}]),t}(a.PureComponent),k=n(81),O=n(132),C=n.n(O),j=n(20),S=function(){return o.a.createElement("div",{style:{width:"30px"}},o.a.createElement("img",{src:"".concat("","/arrow_down.svg"),alt:""}))},x=function(e){var t=e.innerProps,n=e.isDisabled,a=e.label,r=e.value,i=e.isFocused;return n?null:o.a.createElement("div",Object.assign({},t,{style:{padding:"10px",display:"flex",background:i?"#e3e3e3":"",alignItems:"center"}}),o.a.createElement("div",null,o.a.createElement("img",{src:"".concat("","/bus.svg"),style:{width:"30px",padding:"0 10px 0 0"}})),o.a.createElement("div",null,o.a.createElement("h4",{style:{margin:0,marginBottom:"5px"}},a),o.a.createElement("p",{style:{margin:0}},r.longName)))},M=function(e){var t=e.innerProps,n=e.label,a=e.isFocused;return o.a.createElement("div",Object.assign({},t,{style:{padding:"10px",background:a?"#e3e3e3":""}}),o.a.createElement("h4",{style:{margin:0,marginBottom:"5px"}},n))},R=function(e){function t(){var e,n;Object(l.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(s.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={selectedRoute:null,selectedDirection:null,routeOptions:[],directionOptions:[]},n.handleRouteChange=function(e){if(e){j.a.event({category:"Route",action:e.value.shortName});var t=[],a=e.value.patterns;for(var o in a)t.push({label:a[o].headsign,value:a[o]});n.setState({selectedRoute:e,selectedDirection:null,directionOptions:t})}else j.a.event({category:"Route",action:"All"}),n.setState({selectedRoute:null,selectedDirection:null,directionOptions:[]});n.props.onSelect("route",e)},n.handleDirectionChange=function(e){e?(n.setState({selectedDirection:e}),n.props.onSelect("direction",e),j.a.event({category:"Route",action:n.state.selectedRoute.value.shortName,value:e})):(n.setState({selectedDirection:null}),j.a.event({category:"Route",action:"clear direction"})),n.props.onSelect("direction",e)},n.getPatterns=function(e){var t={};return e.forEach(function(e,n){var a=e.headsign.trim().replace(/ /g,"").toLowerCase();void 0!==t[a]&&t[a].directionId===e.directionId||(t[a]=Object(g.a)({},e,{idx:n}))}),t},n.getOptions=function(e){var t=C()(e,"mode"),a=[];Object.keys(t).forEach(function(e){var o=[];t[e].forEach(function(e){e.patterns=n.getPatterns(e.patterns);var t={value:e,label:"".concat(e.shortName)};o.push(t)}),a.push({label:e,options:o})}),n.setState({routeOptions:a})},n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.db.collection("routes").get().then(function(t){var n=[];t.forEach(function(e){n.push(e.data())}),e.getOptions(n)})}},{key:"render",value:function(){var e=this.state,t=e.selectedRoute,n=e.selectedDirection,a=e.routeOptions,r=e.directionOptions,i={control:function(e,t){return Object(g.a)({},e,{minHeight:"48px !important",border:"0 !important",boxShadow:"0px 2px 1px rgba(0,0,0, .2) !important","&:hover":{border:"0 !important"}})},option:function(e){return Object(g.a)({},e)},menu:function(e){return Object(g.a)({},e,{backgroundColor:"white",boxShadow:"1px 2px 6px #888888",top:"calc(100% + 1px)",zIndex:2})},menuList:function(e){return Object(g.a)({},e,{overflowY:"auto"})},menuPortal:function(e){return Object(g.a)({},e,{marginTop:"10px"})}};return o.a.createElement("div",{style:{width:"100%",margin:"0 auto",marginTop:"30px"}},o.a.createElement(k.a,{value:t,options:a,onChange:this.handleRouteChange,isClearable:!0,placeholder:"Enter route number... (E.g.: 550)",styles:i,components:{DropdownIndicator:S,Option:x,IndicatorSeparator:function(){return null}},theme:function(e){return Object(g.a)({},e,{borderRadius:0,border:0,colors:Object(g.a)({},e.colors,{primary25:"lightGray",primary:"Gainsboro"})})}}),o.a.createElement("br",null),this.state.selectedRoute&&o.a.createElement("div",null,o.a.createElement(k.a,{value:n,options:r,onChange:this.handleDirectionChange,placeholder:"Choose Destination...",isClearable:!0,styles:i,components:{DropdownIndicator:S,Option:M,IndicatorSeparator:function(){return null}},theme:function(e){return Object(g.a)({},e,{borderRadius:0,border:0,colors:Object(g.a)({},e.colors,{primary25:"lightGray",primary:"Gainsboro"})})}}),o.a.createElement("br",null)))}}]),t}(o.a.PureComponent),D=function(){return a.createElement("div",{style:{width:"100%",margin:"0 auto",color:"white",top:"300px"}},a.createElement("h2",null,"Helbus - Helsinki Bus Tracker"),a.createElement("p",null,"Track HSL bus/tram/train in real time."),a.createElement("hr",{style:{background:"#f3f3f3",height:"1px",border:"0px"}}),a.createElement("p",null,a.createElement("span",{style:{fontWeight:"bold",marginRight:"5px"}},"Authors:"),a.createElement("a",{href:"http://loveyoung.me",target:"_blank",style:{color:"white",textDecoration:"underline"}},"Li@ng")," ","& Hengda Xiao"),a.createElement("p",null,a.createElement("span",{style:{fontWeight:"bold",marginRight:"5px"}},"Contact:"),a.createElement("a",{href:"mailto:feedback@helbus.live",style:{color:"white"}},"feedback@helbus.live")))},I=(n(255),n(256),function(){return o.a.createElement("div",{className:"spinner"},o.a.createElement("div",{className:"bounce1"}),o.a.createElement("div",{className:"bounce2"}),o.a.createElement("div",{className:"bounce3"}))}),N=n(53),W=n.n(N),L=(n(300),n(302),function(e){return o.a.createElement("svg",Object.assign({viewBox:"0 0 24 24"},e),o.a.createElement("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z",fill:"currentColor"}),o.a.createElement("path",{d:"M0 0h24v24H0z",fill:"none"}))}),P=function(e){return o.a.createElement("svg",Object.assign({viewBox:"0 0 24 24"},e),o.a.createElement("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z",fill:"currentColor"}),o.a.createElement("path",{d:"M0 0h24v24H0z",fill:"none"}))};W.a.initializeApp({apiKey:"AIzaSyDQCOGADe5bDTrF-6qs2Bcm4I9XYHm_oUY",authDomain:"hsltrack.firebaseapp.com",databaseURL:"https://hsltrack.firebaseio.com",projectId:"hsltrack",storageBucket:"hsltrack.appspot.com",messagingSenderId:"941183968719"}),W.a.firestore();var _=W.a.firestore(),A={lat:60.1699,lng:24.9384},B="/hfp/v1/journey/#",T=function(e){function t(){var e,n;Object(l.a)(this,t);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(n=Object(s.a)(this,(e=Object(u.a)(t)).call.apply(e,[this].concat(o)))).state={center:null,panelClassName:window.innerWidth<=600?"panel hide":"panel",mapClassName:window.innerWidth<=600?"map-wrapper full-width":"map-wrapper",routes:[],selectedRoute:null,selectedDirection:null,geos:[]},n.togglePanel=function(){n.setState({panelClassName:"panel"===n.state.panelClassName?"panel hide":"panel",mapClassName:"map-wrapper"===n.state.mapClassName?"map-wrapper full-width":"map-wrapper"})},n.onSelectHandler=function(e,t){if("route"===e)if(t){n.fetchSingleLine(t.value.gtfsId);var a=t.value.gtfsId.split(":")[1];n.setState({selectedRoute:a})}else{var o={selectedRoute:null};window.innerWidth<=600&&(o.panelClassName="panel hide"),n.setState(o)}else if("direction"===e)if(t){var r=parseInt(t.value.directionId);n.setState({selectedDirection:r})}else n.setState({selectedDirection:null})},n}return Object(p.a)(t,e),Object(c.a)(t,[{key:"fetchSingleLine",value:function(e){var t=this;_.collection("routes_geos").doc(e).get().then(function(e){var n=e.data().patterns;t.setState({geos:n})})}},{key:"componentDidMount",value:function(){var e=this;navigator.geolocation?navigator.geolocation.getCurrentPosition(function(t){var n=t.coords,a=n.latitude,o=n.longitude;e.setState({center:{lat:a,lng:o}})},function(){e.setState({center:A})},{timeout:5e3}):this.setState({center:A})}},{key:"render",value:function(){var e=B;return null!==this.state.selectedRoute&&(e="/hfp/v1/journey/+/+/+/+/".concat(this.state.selectedRoute,"/#")),null!==this.state.selectedDirection&&(e="/hfp/v1/journey/+/+/+/+/".concat(this.state.selectedRoute,"/").concat(this.state.selectedDirection+1,"/#")),this.state.center?o.a.createElement("div",{className:"app"},o.a.createElement("div",{className:this.state.panelClassName},o.a.createElement("div",{className:"toggle-btn",onClick:this.togglePanel},"panel"===this.state.panelClassName?o.a.createElement(L,{style:{marginTop:"10px"}}):o.a.createElement(P,{style:{marginTop:"10px"}})),o.a.createElement(R,{onSelect:this.onSelectHandler,db:_,routes:this.state.routes,className:"router-selector"}),o.a.createElement("button",{className:"btn mobile-search",onClick:this.togglePanel},"Search"),o.a.createElement(D,null),o.a.createElement("div",{className:"mobile-app-download-wrapper"},o.a.createElement("a",{href:"https://itunes.apple.com/fi/app/helbus/id1458224268",className:"mobile-app-download-icon",target:"_blank"},o.a.createElement("img",{src:"".concat("","/Apple_Store_Icon.png"),alt:""})),o.a.createElement("a",{href:"https://play.google.com/store/apps/details?id=live.hsltrack",className:"mobile-app-download-icon",target:"_blank"},o.a.createElement("img",{src:"".concat("","/Google_Play_Icon.png"),alt:""})))),o.a.createElement("div",{className:this.state.mapClassName},this.state.selectedDirection?o.a.createElement(E,{center:this.state.center,topic:e,geos:this.state.geos[this.state.selectedDirection]}):o.a.createElement(E,{center:this.state.center,topic:e,geos:this.state.geos[0]})),o.a.createElement("div",{className:"clear"})):o.a.createElement(I,null)}}]),t}(a.PureComponent);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var z=n(32),q=Object(z.b)({mqtt:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:y,t=arguments.length>1?arguments[1]:void 0;return Object(f.isType)(t,v)?Object(g.a)({},e,{topic:t.payload}):e}}),H=Object(z.c)(q,window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__()),F=n(137);console.log=function(){},j.a.initialize("UA-72512078-3"),j.a.pageview(window.location.pathname+window.location.search),i.a.render(o.a.createElement(F.a,{store:H},o.a.createElement(T,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[139,1,2]]]);
//# sourceMappingURL=main.1ca4a4ed.chunk.js.map